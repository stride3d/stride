<Window x:Class="Xenko.GameStudio.GameStudioWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
        xmlns:strings="clr-namespace:Xenko.GameStudio.Resources.Strings"
        xmlns:stringsEd="clr-namespace:Xenko.Core.Assets.Editor.Resources.Strings;assembly=Xenko.Core.Assets.Editor"
        xmlns:vs="clr-namespace:Xenko.Core.VisualStudio;assembly=Xenko.Core.Design"
        xmlns:gs="clr-namespace:Xenko.GameStudio"
        xmlns:xcad="http://schemas.xceed.com/wpf/xaml/avalondock"
        xmlns:sskk="http://schemas.xenko.com/xaml/presentation"
        xmlns:viewModels="clr-namespace:Xenko.Core.Presentation.Quantum.ViewModels;assembly=Xenko.Core.Presentation.Quantum"
        xmlns:viewModels1="clr-namespace:Xenko.Core.Assets.Editor.Components.TemplateDescriptions.ViewModels;assembly=Xenko.Core.Assets.Editor"
        mc:Ignorable="d" d:DesignHeight="300" d:DesignWidth="300"
        Title="{Binding EditorTitle, RelativeSource={RelativeSource Self}}" Width="1280" Height="900" Style="{DynamicResource WindowChromeStyle}"
        PreviewMouseDown="EditorWindowPreviewMouseDown"
        d:DataContext="{d:DesignInstance gs:GameStudioViewModel}" x:Name="EditorWindow">
  <Window.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="Theme.AvalonDock.xaml"/>
        <ResourceDictionary Source="/Xenko.Core.Assets.Editor;component/View/CommonResources.xaml" />
      </ResourceDictionary.MergedDictionaries>

      <DataTemplate x:Key="AvalonDock_GameStudio_TitleTemplate">
        <DockPanel LastChildFill="False">
          <TextBlock DockPanel.Dock="Right" HorizontalAlignment="Center" VerticalAlignment="Top" 
                     Visibility="{Binding Path=Content.DataContext.IsDirty, Converter={sskk:VisibleOrCollapsed}, FallbackValue={sskk:Collapsed}}"
                     Text="*" TextAlignment="Center"/>
          <TextBlock Text="{Binding Title}" TextTrimming="CharacterEllipsis"/>
        </DockPanel>
      </DataTemplate>

      <!-- TODO: Migrate ImageDictionary from Editor to here -->
      <BitmapImage x:Key="ImageReloadProject" UriSource="../Resources/Icons/reload-project.png" />

      <ContextMenu x:Key="AssetContextMenu" d:DataContext="{d:DesignInstance sskk:AssetCollectionViewModel}">
        <!-- Asset -->
        <MenuItem Header="{sskk:Localize Asset, Context=Menu}" Style="{StaticResource MenuGroupSeparatorStyle}"/>
        <MenuItem Header="{sskk:Localize Edit asset..., Context=Menu}" Command="{Binding Session.EditSelectedContentCommand}" Icon="{sskk:Image {StaticResource ImageEditAsset}}" InputGestureText="{x:Static strings:KeyGestures.EditAsset}"/>
        <MenuItem Header="{Binding Session.SelectionIsRoot, Converter={sskk:BoolToParam}, ConverterParameter={sskk:Localize Don\'t include in build as root asset, Context=Menu},
                          FallbackValue={sskk:Localize Include in build as root asset, Context=Menu}}" Command="{Binding Session.ToggleIsRootOnSelectedAssetCommand}"
                          Icon="{sskk:Image {StaticResource ImageAssetIsRoot}}"/>
        <Separator Visibility="{Binding Session.ActiveAssetView.SingleSelectedAsset.AssetCommands.Count, Converter={sskk:Chained {sskk:NumericToBool}, {sskk:VisibleOrCollapsed}}, FallbackValue={sskk:Collapsed}}" />
        <!-- IsCheckable=True is a hack to prevent WPF from clearing the selected sub menu item -->
        <MenuItem ItemsSource="{Binding Session.ActiveAssetView.SingleSelectedAsset.AssetCommands}" IsCheckable="True"
                  Visibility="{Binding HasItems, RelativeSource={RelativeSource Self}, Converter={sskk:VisibleOrCollapsed}, FallbackValue={sskk:Collapsed}}">
          <MenuItem.ItemContainerStyle>
            <Style TargetType="{x:Type MenuItem}" BasedOn="{StaticResource {x:Type MenuItem}}" d:DataContext="{d:DesignInstance sskk:MenuCommandInfo}">
              <Setter Property="Command" Value="{Binding Command}" />
              <Setter Property="CommandParameter" Value="{Binding}" />
              <Setter Property="Header" Value="{Binding DisplayName}" />
              <Setter Property="Icon" Value="{Binding Icon}" />
              <Setter Property="IsEnabled" Value="{Binding Command.IsEnabled, Mode=OneWay}" />
              <Setter Property="ToolTip" Value="{Binding Tooltip}" />
              <Setter Property="InputGestureText" Value="{Binding Gesture}" />
            </Style>
          </MenuItem.ItemContainerStyle>
          <MenuItem.Template>
            <ControlTemplate>
              <StackPanel IsItemsHost="True" />
            </ControlTemplate>
          </MenuItem.Template>
        </MenuItem>
        <Separator/>
        <MenuItem Command="ApplicationCommands.Cut" CommandTarget="{Binding PlacementTarget, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}" Icon="{sskk:Image {StaticResource ImageCut}}"/>
        <MenuItem Command="ApplicationCommands.Copy" CommandTarget="{Binding PlacementTarget, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}" Icon="{sskk:Image {StaticResource ImageCopy}}"/>
        <MenuItem Header="{sskk:Localize Copy with dependencies, Context=Menu}" Command="{Binding CopyAssetsRecursivelyCommand}" InputGestureText="{x:Static strings:KeyGestures.CopyAssetRecursively}" Icon="{sskk:Image {StaticResource ImageCopyRecursively}}"/>
        <MenuItem Command="ApplicationCommands.Paste" CommandTarget="{Binding PlacementTarget, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}" Icon="{sskk:Image {StaticResource ImagePaste}}"/>
        <MenuItem Command="ApplicationCommands.Delete" CommandTarget="{Binding PlacementTarget, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}" Icon="{sskk:Image {StaticResource ImageDelete}}"/>
        <Separator/>
        <MenuItem Header="{sskk:Localize Copy asset URL, Context=Menu}" Command="{Binding CopyAssetUrlCommand}" />
        <MenuItem Header="{sskk:Localize Rename, Context=Menu}" Command="sskk:AssetViewUserControl.BeginEditCommand" Icon="{sskk:Image {StaticResource ImageRename}}" InputGestureText="F2"/>
        <Separator/>
        <MenuItem Header="{sskk:Localize Create folder, Context=Menu}" Command="{Binding Session.NewDirectoryCommand}" CommandParameter="{Binding Session.ActiveAssetView.SelectedLocations}" Icon="{sskk:Image {StaticResource ImageNewFolder}}" Visibility="{Binding Session.NewDirectoryCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}" />
        <MenuItem Header="{sskk:Localize Add asset..., Context=Menu}" Command="{Binding Session.ActiveAssetView.ShowAddAssetDialogCommand}" InputGestureText="{x:Static strings:KeyGestures.AddAsset}" Icon="{sskk:Image {StaticResource ImageNewAsset}}" Visibility="{Binding Session.ActiveAssetView.ShowAddAssetDialogCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>
        <MenuItem Header="{sskk:Localize Update selected assets from their source, Context=Menu}" Command="{Binding Session.SourceTracker.UpdateSelectedAssetsFromSourceCommand}" InputGestureText="{x:Static stringsEd:KeyGestures.UpdateSelectedAssetsFromSource}" Icon="{sskk:Image {StaticResource UpdateSelectedAssetsFromSource}}"/>
        <MenuItem Header="{sskk:Localize Update all assets with modified source, Context=Menu}" Command="{Binding Session.SourceTracker.UpdateAllAssetsWithModifiedSourceCommand}" InputGestureText="{x:Static stringsEd:KeyGestures.UpdateAllAssetsWithModifiedSource}" Icon="{sskk:Image {StaticResource UpdateAllAssetsWithModifiedSource}}"/>
        <!-- Explore -->
        <MenuItem Header="{sskk:Localize Explore, Context=Menu}" Style="{StaticResource MenuGroupSeparatorStyle}"/>
        <MenuItem Header="{sskk:Localize Open with text editor, Context=Menu}" Command="{Binding Session.OpenWithTextEditorCommand}" CommandParameter="{Binding SingleSelectedAsset}" Icon="{sskk:Image {StaticResource ImageOpenWithTextEditor}}"/>
        <MenuItem Header="{sskk:Localize Open asset file, Context=Menu}" Command="{Binding Session.OpenAssetFileCommand}" CommandParameter="{Binding SingleSelectedAsset}" Icon="{sskk:Image {StaticResource ImageOpenAssetFile}}"/>
        <MenuItem Header="{sskk:Localize Open source file, Context=Menu}" Command="{Binding Session.OpenSourceFileCommand}" CommandParameter="{Binding SingleSelectedAsset}" Icon="{sskk:Image {StaticResource ImageOpenSourceFile}}"/>
        <MenuItem Header="{sskk:Localize Show in Explorer, Context=Menu}" Command="{Binding Session.ExploreCommand}" CommandParameter="{Binding SelectedContent}" Icon="{sskk:Image {StaticResource ImageExplore}}"/>
      </ContextMenu>

    </ResourceDictionary>
  </Window.Resources>

  <Window.InputBindings>
    <KeyBinding Command="{Binding Session.ActiveAssetView.CopyAssetsRecursivelyCommand}" Gesture="{sskk:KeyGesture {x:Static strings:KeyGestures.CopyAssetRecursively}}" />
    <KeyBinding Command="{Binding Session.EditSelectedContentCommand}" Gesture="{sskk:KeyGesture {x:Static strings:KeyGestures.EditAsset}}"/>
    <KeyBinding Command="{Binding Session.ActiveAssetView.ShowAddAssetDialogCommand}" Gesture="{sskk:KeyGesture {x:Static strings:KeyGestures.AddAsset}}"/>
    <KeyBinding Command="{Binding Session.SourceTracker.UpdateSelectedAssetsFromSourceCommand}" Gesture="{sskk:KeyGesture {x:Static stringsEd:KeyGestures.UpdateSelectedAssetsFromSource}}"/>
    <KeyBinding Command="{Binding Session.SourceTracker.UpdateAllAssetsWithModifiedSourceCommand}" Gesture="{sskk:KeyGesture {x:Static stringsEd:KeyGestures.UpdateAllAssetsWithModifiedSource}}"/>
    <KeyBinding Command="{Binding Debugging.BuildProjectCommand}" Gesture="{sskk:KeyGesture {x:Static strings:KeyGestures.BuildProject}}"/>
    <KeyBinding Command="{Binding Debugging.StartProjectCommand}" Gesture="{sskk:KeyGesture {x:Static strings:KeyGestures.StartProject}}"/>
    <KeyBinding Command="{Binding Debugging.CancelBuildCommand}" Gesture="{sskk:KeyGesture {x:Static strings:KeyGestures.CancelBuild}}"/>
    <KeyBinding Command="{Binding OpenDebugWindowCommand, RelativeSource={RelativeSource AncestorType=Window}}" Gesture="{sskk:KeyGesture {x:Static strings:KeyGestures.OpenDebugWindow}}"/>
  </Window.InputBindings>

  <i:Interaction.Behaviors>
    <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.New" Command="{Binding NewSessionCommand}"/>
    <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.Open" Command="{Binding OpenSessionCommand}"/>
    <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.Save" Command="{Binding Session.SaveSessionCommand, FallbackValue={x:Static sskk:DisabledCommand.Instance}, Mode=OneWay}"/>
    <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.Undo" Command="{Binding Session.ActionHistory.UndoCommand, FallbackValue={x:Static sskk:DisabledCommand.Instance}, Mode=OneWay}"/>
    <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.Redo" Command="{Binding Session.ActionHistory.RedoCommand, FallbackValue={x:Static sskk:DisabledCommand.Instance}, Mode=OneWay}"/>
  </i:Interaction.Behaviors>

  <Grid>
    <Grid.RowDefinitions>
      <!-- MENU ROW DEFINITION-->
      <RowDefinition Height="Auto"/>
      <!-- DOCUMENT ROW DEFINITION-->
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <!-- MENU ROW -->
    <Menu Grid.Row="0">
      <!-- File Menu -->
      <MenuItem Header="{sskk:Localize File, Context=Menu}">
        <MenuItem Command="ApplicationCommands.New" Icon="{sskk:Image {StaticResource ImageNewSolution}}"/>
        <MenuItem Command="ApplicationCommands.Open" Icon="{sskk:Image {StaticResource ImageOpen}}"/>
        <MenuItem Header="{sskk:Localize Open recent, Context=Menu}" Icon="{sskk:Image {StaticResource ImageOpen}}" IsEnabled="{Binding MRU.MostRecentlyUsedFiles.Count, Converter={sskk:NumericToBool}}">
          <!-- IsCheckable=True is a hack to prevent WPF from clearing the selected sub menu item -->
          <MenuItem ItemsSource="{Binding MRU.MostRecentlyUsedFiles, Converter={sskk:Take}, ConverterParameter={sskk:Int 10}}" IsCheckable="True">
            <MenuItem.ItemTemplate>
              <DataTemplate>
                <Grid HorizontalAlignment="Stretch" ToolTip="{Binding FilePath, Converter={sskk:UFileToString}, Mode=OneWay}">
                  <Grid.ColumnDefinitions >
                    <ColumnDefinition Width="30"/>
                    <ColumnDefinition MaxWidth="320"/>
                  </Grid.ColumnDefinitions>
                  <TextBlock Grid.Column="0" Text="{Binding Version}" FontWeight="Bold" />
                  <TextBlock Grid.Column="1"
                             Text="{sskk:MultiBinding {Binding FilePath, Converter={sskk:UFileToString}, Mode=OneWay}, {Binding RelativeSource={RelativeSource Self}},
                                                      Converter={sskk:TrimString MaxWidth=320, TextTrimming=WordEllipsis, TrimmingSource=Middle, WordSeparators=/\\}}"/>
                </Grid>
              </DataTemplate>
            </MenuItem.ItemTemplate>
            <MenuItem.ItemContainerStyle>
              <Style TargetType="{x:Type MenuItem}" BasedOn="{StaticResource {x:Type MenuItem}}">
                <Setter Property="Command" Value="{Binding DataContext.OpenSessionCommand, RelativeSource={RelativeSource AncestorType=Menu}}"/>
                <Setter Property="CommandParameter" Value="{Binding FilePath}"/>
              </Style>
            </MenuItem.ItemContainerStyle>
            <MenuItem.Template>
              <ControlTemplate>
                <StackPanel IsItemsHost="True"/>
              </ControlTemplate>
            </MenuItem.Template>
          </MenuItem>
          <Separator/>
          <MenuItem Header="{sskk:Localize Clear list, Context=Menu}" Command="{Binding ClearMRUCommand}" Icon="{sskk:Image {StaticResource ImageDelete}}"/>
        </MenuItem>
        <MenuItem Command="ApplicationCommands.Save" Icon="{sskk:Image {StaticResource ImageSave}}"/>
        <Separator/>
        <MenuItem Header="{sskk:Localize Reload project, Context=Menu}" Command="{Binding ReloadSessionCommand}" Icon="{sskk:Image {StaticResource ImageReloadProject}}"/>
        <Separator/>
        <MenuItem Header="{sskk:Localize Quit, Context=Menu}">
          <i:Interaction.Behaviors>
            <sskk:MenuItemCloseWindowBehavior/>
          </i:Interaction.Behaviors>
        </MenuItem>
      </MenuItem>
      <!-- Edit Menu -->
      <MenuItem Header="{sskk:Localize Edit, Context=Menu}">
        <MenuItem Command="ApplicationCommands.Undo" Icon="{sskk:Image {StaticResource ImageUndo}}"/>
        <MenuItem Command="ApplicationCommands.Redo" Icon="{sskk:Image {StaticResource ImageRedo}}"/>
        <Separator/>
        <MenuItem Command="ApplicationCommands.Cut" Icon="{sskk:Image {StaticResource ImageCut}}" />
        <MenuItem Command="ApplicationCommands.Copy" Icon="{sskk:Image {StaticResource ImageCopy}}" />
        <MenuItem Command="ApplicationCommands.Paste" Icon="{sskk:Image {StaticResource ImagePaste}}" />
        <MenuItem Command="ApplicationCommands.Delete" Icon="{sskk:Image {StaticResource ImageDelete}}"/>
        <Separator/>
        <MenuItem Header="{sskk:Localize Settings, Context=Menu}" Command="{Binding OpenSettingsWindowCommand}" Icon="{sskk:Image {StaticResource ImageSettings}}"/>
      </MenuItem>
      <!-- Project Menu -->
      <MenuItem Header="{sskk:Localize Project, Context=Menu}" IsEnabled="{Binding Session, Converter={sskk:ObjectToBool}}">
        <MenuItem Header="{sskk:Localize Build project, Context=Menu}" Command="{Binding Debugging.BuildProjectCommand}" Icon="{sskk:Image {StaticResource ImageBuildProject}}" InputGestureText="{x:Static strings:KeyGestures.BuildProject}"/>
        <MenuItem Header="{sskk:Localize Start project, Context=Menu}" Command="{Binding Debugging.StartProjectCommand}" Icon="{sskk:Image {StaticResource ImageStartProject}}" InputGestureText="{x:Static strings:KeyGestures.StartProject}"/>
        <!-- Disable live-scripting commands until it is working -->
        <MenuItem Header="{sskk:Localize Start live-scripting, Context=Menu}" Command="{Binding Debugging.LivePlayProjectCommand}" Icon="{sskk:Image {StaticResource ImageLiveScripting}}" Visibility="Collapsed"/>
        <MenuItem Header="{sskk:Localize Cancel build, Context=Menu}" Command="{Binding Debugging.CancelBuildCommand}" Icon="{sskk:Image {StaticResource ImageStopBuild}}" InputGestureText="{x:Static strings:KeyGestures.CancelBuild}"/>
        <MenuItem Header="{sskk:Localize Folder, Context=Menu}" Style="{StaticResource MenuGroupSeparatorStyle}"/>
        <MenuItem Header="{sskk:Localize Create folder, Context=Menu}" Command="{Binding Session.NewDirectoryCommand}" CommandParameter="{Binding Session.ActiveAssetView.SelectedLocations}" Icon="{sskk:Image {StaticResource ImageNewFolder}}"/>

        <MenuItem Header="{sskk:Localize Package, Context=Menu}" Style="{StaticResource MenuGroupSeparatorStyle}"/>
        <MenuItem Header="{sskk:Localize Update package, Context=Menu}" ItemsSource="{Binding Session.UpdatePackageViewModel.Templates}" Icon="{sskk:Image {StaticResource ImageAddNewProject}}" Visibility="{Binding Session.IsUpdatePackageEnabled, Converter={sskk:VisibleOrCollapsed}}">
          <MenuItem.ItemContainerStyle>
            <Style TargetType="{x:Type MenuItem}" BasedOn="{StaticResource {x:Type MenuItem}}" d:DataContext="{d:DesignInstance viewModels1:TemplateDescriptionViewModel}">
              <Setter Property="Command" Value="{Binding UpdatePackageCommand}"/>
            </Style>
          </MenuItem.ItemContainerStyle>
          <MenuItem.ItemTemplate>
            <DataTemplate DataType="viewModels1:TemplateDescriptionViewModel">
              <DockPanel Width="384">
                <Image Source="{Binding Icon}" DockPanel.Dock="Left" Width="48" Height="48" Margin="2"/>
                <DockPanel Margin="18,0">
                  <TextBlock DockPanel.Dock="Top" FontSize="16" Text="{Binding Name}"/>
                  <TextBlock Text="{Binding Description}" TextWrapping="Wrap" TextTrimming="WordEllipsis"/>
                </DockPanel>
              </DockPanel>
            </DataTemplate>
          </MenuItem.ItemTemplate>
        </MenuItem>
        <MenuItem Header="{sskk:Localize Add existing project..., Context=Menu}" Command="{Binding Session.AddExistingProjectCommand}" Icon="{sskk:Image {StaticResource ImageAddExistingProject}}"/>
        <MenuItem Header="{sskk:Localize Add dependency..., Context=Menu}" Command="{Binding Session.AddDependencyCommand}" Icon="{sskk:Image {StaticResource ImageAddDependency}}"/>
        <MenuItem Header="{sskk:Localize Set as current package, Context=Menu}" Command="{Binding Session.SetCurrentPackageCommand}" CommandParameter="{Binding}" Icon="{sskk:Image {StaticResource ImageStartupProject}}"/>
        <MenuItem Header="{sskk:Localize Package properties, Context=Menu}" Command="{Binding Session.ActivatePackagePropertiesCommand}" Icon="{sskk:Image {StaticResource ImagePackageProperties}}"/>

        <MenuItem Header="{sskk:Localize Solution, Context=Menu}" Style="{StaticResource MenuGroupSeparatorStyle}"/>
        <MenuItem Header="{sskk:Localize New package..., Context=Menu}" Command="{Binding Session.NewPackageCommand}" Icon="{sskk:Image {StaticResource ImageAddNewPackage}}"/>
        <MenuItem Header="{sskk:Localize Add existing package..., Context=Menu}" Command="{Binding Session.AddExistingPackageCommand}" Icon="{sskk:Image {StaticResource ImageAddExistingPackage}}"/>
        <MenuItem Header="{sskk:Localize Open in IDE, Context=Menu}" Command="{Binding Session.OpenInIDECommand}" Icon="{sskk:Image {StaticResource ImageVisualStudio}}"/>
        <MenuItem Header="{sskk:Localize Reload game assemblies, Context=Menu}" Command="{Binding Debugging.ReloadAssembliesCommand}" Icon="{sskk:Image {StaticResource ImageReloadAssemblies}}"/>

        <MenuItem Header="{sskk:Localize Actions, Context=Menu}" Style="{StaticResource MenuGroupSeparatorStyle}"/>
        <MenuItem Header="{sskk:Localize Delete, Context=Menu}" Command="{Binding Session.DeleteSelectedSolutionItemsCommand}" Icon="{sskk:Image {StaticResource ImageDelete}}"/>
        <MenuItem Header="{sskk:Localize Rename, Context=Menu}" Command="{Binding Session.RenameDirectoryOrPackageCommand, FallbackValue={x:Static sskk:DisabledCommand.Instance}}" CommandParameter="{Binding Session.ActiveAssetView.SelectedLocations}" Icon="{sskk:Image {StaticResource ImageRename}}" InputGestureText="F2"/>

        <MenuItem Header="{sskk:Localize Asset, Context=Menu}" Style="{StaticResource MenuGroupSeparatorStyle}"/>
        <MenuItem Header="{sskk:Localize Add asset..., Context=Menu}" Command="{Binding Session.ActiveAssetView.ShowAddAssetDialogCommand}" InputGestureText="{x:Static strings:KeyGestures.AddAsset}" Icon="{sskk:Image {StaticResource ImageNewAsset}}"/>
        <MenuItem Header="{sskk:Localize Update selected assets from their source, Context=Menu}" Command="{Binding Session.SourceTracker.UpdateSelectedAssetsFromSourceCommand}" InputGestureText="{x:Static stringsEd:KeyGestures.UpdateSelectedAssetsFromSource}" Icon="{sskk:Image {StaticResource UpdateSelectedAssetsFromSource}}"/>
        <MenuItem Header="{sskk:Localize Update all assets with modified source, Context=Menu}" Command="{Binding Session.SourceTracker.UpdateAllAssetsWithModifiedSourceCommand}" InputGestureText="{x:Static stringsEd:KeyGestures.UpdateAllAssetsWithModifiedSource}" Icon="{sskk:Image {StaticResource UpdateAllAssetsWithModifiedSource}}" Visibility="{Binding Session.NewDirectoryCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>
        <MenuItem Header="{sskk:Localize Explore, Context=Menu}" Style="{StaticResource MenuGroupSeparatorStyle}" Visibility="{Binding Session.ExploreCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>
        <MenuItem Header="{sskk:Localize Show in Explorer, Context=Menu}" Command="{Binding Session.ExploreCommand}" CommandParameter="{Binding Session.ActiveAssetView.SelectedLocations}" Icon="{sskk:Image {StaticResource ImageExplore}}" Visibility="{Binding Session.ExploreCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>
      </MenuItem>
      <!-- View Menu -->
      <MenuItem Header="{sskk:Localize View, Context=Menu}" IsEnabled="{Binding Session, Converter={sskk:ObjectToBool}}">
        <MenuItem Header="{sskk:Localize Solution explorer, Context=Menu}" IsCheckable="True" IsChecked="{Binding Panels.SessionExplorerPanelVisible, Mode=TwoWay}"/>
        <MenuItem Header="{sskk:Localize Asset view, Context=Menu}" IsCheckable="True" IsChecked="{Binding Panels.AssetViewPanelVisible, Mode=TwoWay}"/>
        <MenuItem Header="{sskk:Localize References, Context=Menu}" IsCheckable="True" IsChecked="{Binding Panels.ReferencesPanelVisible, Mode=TwoWay}"/>
        <Separator/>
        <MenuItem Header="{sskk:Localize Asset preview, Context=Menu}" IsCheckable="True" IsChecked="{Binding Panels.AssetPreviewPanelVisible, Mode=TwoWay}"/>

        <Separator/>
        <MenuItem Header="{sskk:Localize Property grid, Context=Menu}" IsCheckable="True" IsChecked="{Binding Panels.PropertyGridPanelVisible, Mode=TwoWay}"/>
        <MenuItem Header="{sskk:Localize Edit history, Context=Menu}" IsCheckable="True" IsChecked="{Binding Panels.ActionHistoryPanelVisible, Mode=TwoWay}"/>

        <Separator/>
        <MenuItem Header="{sskk:Localize Asset errors, Context=Menu}" IsCheckable="True" IsChecked="{Binding Panels.AssetLogPanelVisible, Mode=TwoWay}"/>
        <MenuItem Header="{sskk:Localize Output, Context=Menu}" IsCheckable="True" IsChecked="{Binding Panels.BuildLogPanelVisible, Mode=TwoWay}"/>

      </MenuItem>
      <!-- Help Menu -->
      <MenuItem Header="{sskk:Localize Help, Context=Menu}">
        <MenuItem Header="{sskk:Localize Online documentation, Context=Menu}" Command="{Binding OpenWebPageCommand}" CommandParameter="{x:Static gs:XenkoGameStudio.DocumentationUrl}"/>
        <Separator/>
        <MenuItem Header="{sskk:Localize Questions and answers, Context=Menu}" Command="{Binding OpenWebPageCommand}" CommandParameter="{x:Static gs:XenkoGameStudio.AnswersUrl}"/>
        <MenuItem Header="{sskk:Localize Report an issue..., Context=Menu}" Command="{Binding OpenWebPageCommand}" CommandParameter="{x:Static gs:XenkoGameStudio.ReportIssueUrl}"/>
        <MenuItem Header="{sskk:Localize Community forums, Context=Menu}" Command="{Binding OpenWebPageCommand}" CommandParameter="{x:Static gs:XenkoGameStudio.ForumsUrl}"/>
        <Separator/>
        <MenuItem Header="{sskk:Localize Show debug window, Context=Menu}" Command="{Binding OpenDebugWindowCommand, RelativeSource={RelativeSource AncestorType=Window}}" InputGestureText="{x:Static strings:KeyGestures.OpenDebugWindow}"/>
        <Separator/>
        <MenuItem Header="{sskk:Localize About..., Context=Menu}" Command="{Binding OpenAboutPageCommand}"/>
      </MenuItem>
      <!-- Debug Menu -->
      <MenuItem Header="Debug" Visibility="{Binding IsTestMenuVisible, ElementName=EditorWindow, Converter={sskk:VisibleOrCollapsed}}">
        <MenuItem Header="Create test asset" Command="{Binding CreateTestAssetCommand, RelativeSource={RelativeSource AncestorType=Window}}"/>
        <MenuItem Header="Create unit test asset" Command="{Binding CreateUnitTestAssetCommand, RelativeSource={RelativeSource AncestorType=Window}}"/>
        <Separator/>
        <MenuItem Header="Break with debugger" Command="{Binding BreakDebuggerCommand, RelativeSource={RelativeSource AncestorType=Window}}"/>
      </MenuItem>
    </Menu>

    <!-- DOCUMENT ROW -->
    <Grid Grid.Row="1">
      <Grid.RowDefinitions>
        <!-- TOOLBAR ROW DEFINITION-->
        <RowDefinition Height="Auto"/>
        <!-- DOCKING ROW DEFINITION -->
        <RowDefinition Height="*"/>
        <!-- STATUS BAR ROW DEFINITION-->
        <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>

      <!-- TOOLBAR ROW -->
      <ToolBarTray Grid.Row="0" Visibility="{Binding Session, Converter={sskk:Chained {sskk:ObjectToBool}, {sskk:VisibleOrCollapsed}}}">
        <ToolBar>
          <Button Command="ApplicationCommands.New"
                  ToolTip="{sskk:Localize Create a project, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
            <Image Source="{StaticResource ImageNewSolution}" />
          </Button>
          <Button Command="ApplicationCommands.Open" Margin="2,0,0,0"
                  ToolTip="{sskk:Localize Open an existing project, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
            <Image Source="{StaticResource ImageOpen}" />
          </Button>
          <Menu Background="Transparent" Margin="0"
                ToolTip="{sskk:Localize Open recent, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True"
                ToolTipService.IsEnabled="{Binding ElementName=MRUMenu, Path=IsSubmenuOpen, Converter={sskk:InvertBool}}">
            <MenuItem x:Name="MRUMenu" ItemsSource="{Binding MRU.MostRecentlyUsedFiles, Converter={sskk:Take}, ConverterParameter={sskk:Int 10}}" Style="{StaticResource ToolBarDropDownMenuItemStyle}">
              <MenuItem.ItemTemplate>
                <DataTemplate>
                  <Grid HorizontalAlignment="Stretch" ToolTip="{Binding FilePath, Converter={sskk:UFileToString}, Mode=OneWay}">
                    <Grid.ColumnDefinitions >
                      <ColumnDefinition Width="30"/>
                      <ColumnDefinition MaxWidth="320"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="{Binding Version}" FontWeight="Bold" />
                    <TextBlock Grid.Column="1"
                               Text="{sskk:MultiBinding {Binding FilePath, Converter={sskk:UFileToString}, Mode=OneWay}, {Binding RelativeSource={RelativeSource Self}},
                                                        Converter={sskk:TrimString MaxWidth=320, TextTrimming=WordEllipsis, TrimmingSource=Middle, WordSeparators=/\\}}"/>
                  </Grid>
                </DataTemplate>
              </MenuItem.ItemTemplate>
              <MenuItem.ItemContainerStyle>
                <Style TargetType="{x:Type MenuItem}" BasedOn="{StaticResource {x:Type MenuItem}}">
                  <Setter Property="Command" Value="{Binding DataContext.OpenSessionCommand, RelativeSource={RelativeSource AncestorType=Menu}}"/>
                  <Setter Property="CommandParameter" Value="{Binding FilePath}"/>
                </Style>
              </MenuItem.ItemContainerStyle>
            </MenuItem>
          </Menu>
          <Button Command="ApplicationCommands.Save"
                  ToolTip="{sskk:Localize Save the project and all its documents, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
            <Image Source="{StaticResource ImageSave}" />
          </Button>
          <Separator/>
          <Button Command="{Binding ReloadSessionCommand}"
                  ToolTip="{sskk:Localize Reload current project (ask to save), Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
            <Image Source="{StaticResource ImageReloadProject}" />
          </Button>
          <Separator/>
          <Button Command="ApplicationCommands.Undo"
                  ToolTip="{sskk:Localize Undo last action, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
            <Image Source="{StaticResource ImageUndo}" />
          </Button>
          <Button Command="ApplicationCommands.Redo"
                  ToolTip="{sskk:Localize Redo last cancelled action, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
            <Image Source="{StaticResource ImageRedo}" />
          </Button>
        </ToolBar>
        <ToolBar>
          <Button Command="{Binding Session.OpenInIDECommand}" Margin="2,0,0,0"
                  ToolTip="{sskk:Localize Open in IDE, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
            <Image Source="{StaticResource ImageVisualStudio}" />
          </Button>
          <Menu Background="Transparent"
                ToolTip="{sskk:Localize Open with..., Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
            <MenuItem ItemsSource="{Binding AvailableIDEs}" Style="{StaticResource ToolBarDropDownMenuItemStyle}">
              <MenuItem.ItemContainerStyle>
                <Style TargetType="{x:Type MenuItem}" BasedOn="{StaticResource {x:Type MenuItem}}">
                  <Setter Property="Command" Value="{Binding DataContext.Session.OpenInIDECommand, RelativeSource={RelativeSource AncestorType=Menu}}"/>
                  <Setter Property="CommandParameter" Value="{Binding}"/>
                </Style>
              </MenuItem.ItemContainerStyle>
            </MenuItem>
          </Menu>
          <Button Command="{Binding Debugging.ReloadAssembliesCommand}"
                  ToolTip="{sskk:Localize Reload game assemblies and update scripts, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
            <Grid>
              <Image Source="{StaticResource ImageReloadAssemblies}"/>
              <Rectangle Fill="White" Visibility="{Binding Debugging.ReloadAssembliesCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}">
                <Rectangle.OpacityMask>
                  <ImageBrush ImageSource="{StaticResource ImageReloadAssemblies}"/>
                </Rectangle.OpacityMask>
                <Rectangle.Triggers>
                  <EventTrigger RoutedEvent="Window.Loaded">
                    <BeginStoryboard>
                      <Storyboard RepeatBehavior="Forever">
                        <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.5" BeginTime="0:0:0" AutoReverse="True"/>
                      </Storyboard>
                    </BeginStoryboard>
                  </EventTrigger>
                </Rectangle.Triggers>
              </Rectangle>
            </Grid>
          </Button>
          <Separator/>
          <Button Command="{Binding Debugging.BuildProjectCommand}"
                  ToolTip="{sskk:ToolTip {sskk:Localize Build the project, Context=ToolTip}, {x:Static strings:KeyGestures.BuildProject}}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
            <Image Source="{StaticResource ImageBuildProject}"/>
          </Button>
          <Button Command="{Binding Debugging.StartProjectCommand}"
                  ToolTip="{sskk:ToolTip {sskk:Localize Build the project and start the game, Context=ToolTip}, {x:Static strings:KeyGestures.StartProject}}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
            <Image Source="{StaticResource ImageStartProject}"/>
          </Button>
          <!-- Live Scripting -->
          <!-- FIXME live scripting is disabled (XK-4309) -->
          <Button Command="{Binding Debugging.LivePlayProjectCommand}"
                  ToolTip="{sskk:Localize Start project in live-scripting mode, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True"
                  Visibility="Collapsed">
            <Image Source="{StaticResource ImageLiveScripting}"/>
          </Button>
          <Button Command="{Binding Debugging.CancelBuildCommand}"
                  ToolTip="{sskk:ToolTip {sskk:Localize Cancel the current build, Context=ToolTip}, {x:Static strings:KeyGestures.CancelBuild}}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
            <Image Source="{StaticResource ImageStopBuild}"/>
          </Button>

          <ComboBox ItemsSource="{Binding Session.CurrentPackage.ExecutableProfiles}" SelectedItem="{Binding Session.CurrentPackage.SelectedProfile}" Width="150">
            <ComboBox.ItemTemplate>
              <DataTemplate>
                <StackPanel Orientation="Horizontal">
                  <Image Width="16" Height="16" Source="{Binding Platform, Converter={sskk:StaticResourceConverter}}" Margin="0,0,4,0"/>
                  <TextBlock Text="{Binding Name}"/>
                </StackPanel>
              </DataTemplate>
            </ComboBox.ItemTemplate>
          </ComboBox>
        </ToolBar>
      </ToolBarTray>

      <!-- DOCKING ROW -->
      <xcad:DockingManager x:Name="Docking" Grid.Row="1" Visibility="{Binding Session, Converter={sskk:Chained {sskk:ObjectToBool}, {sskk:VisibleOrCollapsed}}}"
                           AllowMixedOrientation="True"
                           DocumentHeaderTemplate="{StaticResource AvalonDock_GameStudio_TitleTemplate}" DocumentTitleTemplate="{StaticResource AvalonDock_GameStudio_TitleTemplate}" AnchorableTitleTemplate="{StaticResource AvalonDock_GameStudio_TitleTemplate}">
        <xcad:LayoutRoot>
          <xcad:LayoutPanel Orientation="Horizontal">
            <xcad:LayoutPanel Orientation="Vertical">
              <xcad:LayoutPanel Orientation="Horizontal">
                <xcad:LayoutAnchorablePane DockWidth="240">
                  <!-- SOLUTION EXPLORER -->
                  <xcad:LayoutAnchorable ContentId="SolutionExplorer" Title="{Binding Source={sskk:Localize Solution explorer, Context=View}}"
                                         gs:AvalonDockHelper.IsVisible="{Binding Panels.SessionExplorerPanelVisible, Mode=TwoWay, 
                                         Source={x:Static gs:GameStudioViewModel.GameStudio}, FallbackValue={sskk:True}}">
                    <DockPanel>
                      <ToolBarTray DockPanel.Dock="Top">
                        <ToolBar>
                          <Button Command="{Binding Session.NewPackageCommand}"
                            ToolTip="{sskk:Localize Create a package..., Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
                            <Image Source="{StaticResource ImageAddNewPackage}" />
                          </Button>
                          <Button Command="{Binding Session.NewDirectoryCommand}" CommandParameter="{Binding SelectedItems, ElementName=DirectoryTreeView}"
                            ToolTip="{sskk:Localize Create a folder, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
                            <Image Source="{StaticResource ImageNewFolder}" />
                          </Button>
                          <Separator/>
                          <Button Command="{Binding Session.ActivatePackagePropertiesCommand}"
                            ToolTip="{sskk:Localize Display the properties of the selected package in the property grid, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
                            <Image Source="{StaticResource ImagePackageProperties}" />
                          </Button>
                          <Button Command="{Binding Session.RenameDirectoryOrPackageCommand, FallbackValue={x:Static sskk:DisabledCommand.Instance}}" CommandParameter="{Binding SelectedItems, ElementName=DirectoryTreeView}"
                            ToolTip="{sskk:Localize Rename the selected folder or package, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
                            <Image Source="{StaticResource ImageRename}" />
                          </Button>
                          <Button Command="{Binding Session.DeleteSelectedSolutionItemsCommand}"
                            ToolTip="{sskk:Localize Delete the selected items, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
                            <Image Source="{StaticResource ImageDelete}" />
                          </Button>
                          <Separator/>
                          <Button Command="{x:Static sskk:SessionExplorerHelper.ExpandAssetFolders}" CommandTarget="{Binding ElementName=DirectoryTreeView}"
                            ToolTip="{sskk:Localize Expand all asset folders, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
                            <Image Source="{StaticResource ImageExpandAssetFolders}" />
                          </Button>
                          <Button Command="{x:Static sskk:SessionExplorerHelper.ExpandAllFolders}" CommandTarget="{Binding ElementName=DirectoryTreeView}"
                            ToolTip="{sskk:Localize Expand all, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
                            <Image Source="{StaticResource ImageExpandAllFolders}" />
                          </Button>
                          <Button Command="{x:Static sskk:SessionExplorerHelper.CollapseAllFolders}" CommandTarget="{Binding ElementName=DirectoryTreeView}"
                            ToolTip="{sskk:Localize Collapse all, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
                            <Image Source="{StaticResource ImageCollapseAllFolders}" />
                          </Button>
                          <Separator/>
                          <Button Command="{Binding Session.ExploreCommand}" CommandParameter="{Binding SelectedItems, ElementName=DirectoryTreeView}"
                            ToolTip="{sskk:Localize Show in Explorer, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Status}" ToolTipService.ShowOnDisabled="True">
                            <Image Source="{StaticResource ImageExplore}" />
                          </Button>
                        </ToolBar>
                      </ToolBarTray>
                      <!-- TODO: SearchText -->
                      <sskk:TreeView x:Name="DirectoryTreeView" ItemsSource="{Binding Session.PackageCategories.Values}" AllowDrop="True" IsVirtualizing="False">
                        <sskk:TreeView.Resources>
                          <ContextMenu x:Key="ContextMenu">
                            <MenuItem Header="{sskk:Localize Folder, Context=Menu}" Style="{StaticResource MenuGroupSeparatorStyle}" Visibility="{Binding Session.NewDirectoryCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>
                            <MenuItem Header="{sskk:Localize Create folder, Context=Menu}" Command="{Binding Session.NewDirectoryCommand}" CommandParameter="{Binding Session.ActiveAssetView.SelectedLocations}" Icon="{sskk:Image {StaticResource ImageNewFolder}}" Visibility="{Binding Session.NewDirectoryCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>

                            <MenuItem Header="{sskk:Localize Package, Context=Menu}" Style="{StaticResource MenuGroupSeparatorStyle}" Visibility="{sskk:MultiBinding {Binding Session.IsUpdatePackageEnabled}, {Binding Session.AddExistingProjectCommand.IsEnabled}, {Binding Session.AddDependencyCommand.IsEnabled}, {Binding Session.SetCurrentPackageCommand.IsEnabled}, Converter={sskk:MultiChained {sskk:OrMultiConverter}, {sskk:VisibleOrCollapsed}}}"/>
                            <MenuItem Header="{sskk:Localize Update package, Context=Menu}" ItemsSource="{Binding Session.UpdatePackageViewModel.Templates}" Icon="{sskk:Image {StaticResource ImageAddNewProject}}" Visibility="{Binding Session.IsUpdatePackageEnabled, Converter={sskk:VisibleOrCollapsed}}">
                              <MenuItem.ItemContainerStyle>
                                <Style TargetType="{x:Type MenuItem}" BasedOn="{StaticResource {x:Type MenuItem}}" d:DataContext="{d:DesignInstance viewModels1:TemplateDescriptionViewModel}">
                                  <Setter Property="Command" Value="{Binding UpdatePackageCommand}"/>
                                </Style>
                              </MenuItem.ItemContainerStyle>
                              <MenuItem.ItemTemplate>
                                <DataTemplate DataType="viewModels1:TemplateDescriptionViewModel">
                                  <DockPanel Width="384">
                                    <Image Source="{Binding Icon}" DockPanel.Dock="Left" Width="48" Height="48" Margin="2"/>
                                    <DockPanel Margin="18,0">
                                      <TextBlock DockPanel.Dock="Top" FontSize="16" Text="{Binding Name}"/>
                                      <TextBlock Text="{Binding Description}" TextWrapping="Wrap" TextTrimming="WordEllipsis"/>
                                    </DockPanel>
                                  </DockPanel>
                                </DataTemplate>
                              </MenuItem.ItemTemplate>
                            </MenuItem>
                            <MenuItem Header="{sskk:Localize Add existing project..., Context=Menu}" Command="{Binding Session.AddExistingProjectCommand}" Icon="{sskk:Image {StaticResource ImageAddExistingProject}}" Visibility="{Binding Session.AddExistingProjectCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>
                            <MenuItem Header="{sskk:Localize Add dependency..., Context=Menu}" Command="{Binding Session.AddDependencyCommand}" Icon="{sskk:Image {StaticResource ImageAddDependency}}" Visibility="{Binding Session.AddDependencyCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>
                            <MenuItem Header="{sskk:Localize Set as current package, Context=Menu}" Command="{Binding Session.SetCurrentPackageCommand}" CommandParameter="{Binding}" Icon="{sskk:Image {StaticResource ImageStartupProject}}" Visibility="{Binding Session.SetCurrentPackageCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>
                            <MenuItem Header="{sskk:Localize Package properties, Context=Menu}" Command="{Binding Session.ActivatePackagePropertiesCommand}" Icon="{sskk:Image {StaticResource ImagePackageProperties}}" Visibility="{Binding Session.ActivatePackagePropertiesCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>

                            <MenuItem Header="{sskk:Localize Solution, Context=Menu}" Style="{StaticResource MenuGroupSeparatorStyle}" Visibility="{sskk:MultiBinding {Binding Session.NewPackageCommand.IsEnabled}, {Binding Session.AddExistingPackageCommand.IsEnabled}, {Binding Session.OpenInIDECommand.IsEnabled}, Converter={sskk:MultiChained {sskk:OrMultiConverter}, {sskk:VisibleOrCollapsed}}}"/>
                            <MenuItem Header="{sskk:Localize New package..., Context=Menu}" Command="{Binding Session.NewPackageCommand}" Icon="{sskk:Image {StaticResource ImageAddNewPackage}}" Visibility="{Binding Session.NewPackageCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>
                            <MenuItem Header="{sskk:Localize Add existing package..., Context=Menu}" Command="{Binding Session.AddExistingPackageCommand}" Icon="{sskk:Image {StaticResource ImageAddExistingPackage}}" Visibility="{Binding Session.AddExistingPackageCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>
                            <MenuItem Header="{sskk:Localize Open in IDE, Context=Menu}" Command="{Binding Session.OpenInIDECommand}" Icon="{sskk:Image {StaticResource ImageVisualStudio}}" Visibility="{Binding Session.OpenInIDECommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>

                            <MenuItem Header="{sskk:Localize Actions, Context=Menu}" Style="{StaticResource MenuGroupSeparatorStyle}"/>
                            <MenuItem Command="ApplicationCommands.Cut" CommandTarget="{Binding PlacementTarget, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}" Icon="{sskk:Image {StaticResource ImageCut}}"/>
                            <MenuItem Command="ApplicationCommands.Copy" CommandTarget="{Binding PlacementTarget, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}" Icon="{sskk:Image {StaticResource ImageCopy}}"/>
                            <MenuItem Command="ApplicationCommands.Paste" CommandTarget="{Binding PlacementTarget, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}" Icon="{sskk:Image {StaticResource ImagePaste}}"/>
                            <MenuItem Command="ApplicationCommands.Delete" CommandTarget="{Binding PlacementTarget, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}" Icon="{sskk:Image {StaticResource ImageDelete}}"/>
                            <MenuItem Header="{sskk:Localize Rename, Context=Menu}" Command="{Binding Session.RenameDirectoryOrPackageCommand, FallbackValue={x:Static sskk:DisabledCommand.Instance}}" CommandParameter="{Binding Session.ActiveAssetView.SelectedLocations}" Icon="{sskk:Image {StaticResource ImageRename}}" Visibility="{Binding Session.RenameDirectoryOrPackageCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}" InputGestureText="F2"/>

                            <MenuItem Header="{sskk:Localize Asset, Context=Menu}" Style="{StaticResource MenuGroupSeparatorStyle}" Visibility="{Binding Session.NewDirectoryCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>
                            <MenuItem Header="{sskk:Localize Add asset..., Context=Menu}" Command="{Binding Session.ActiveAssetView.ShowAddAssetDialogCommand}" InputGestureText="{x:Static strings:KeyGestures.AddAsset}" Icon="{sskk:Image {StaticResource ImageNewAsset}}" Visibility="{Binding Session.NewDirectoryCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>

                            <MenuItem Header="{sskk:Localize Explore, Context=Menu}" Style="{StaticResource MenuGroupSeparatorStyle}" Visibility="{Binding Session.ExploreCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>
                            <MenuItem Header="{sskk:Localize Show in Explorer, Context=Menu}" Command="{Binding Session.ExploreCommand}" CommandParameter="{Binding}" Icon="{sskk:Image {StaticResource ImageExplore}}" Visibility="{Binding Session.ExploreCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}}"/>

                          </ContextMenu>
                        </sskk:TreeView.Resources>
                        <i:Interaction.Behaviors>
                          <sskk:DragOverAutoScrollBehavior/>
                          <sskk:TreeViewAutoExpandBehavior/>
                          <sskk:TreeViewDragDropBehavior DragVisualTemplate="{StaticResource DragVisualTemplate}"/>
                          <sskk:TreeViewBindableSelectedItemsBehavior SelectedItems="{Binding Session.ActiveAssetView.SelectedLocations}"/>
                          <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.Cut" Command="{Binding Session.ActiveAssetView.CutLocationsCommand, FallbackValue={x:Static sskk:DisabledCommand.Instance}, Mode=OneWay}"/>
                          <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.Copy" Command="{Binding Session.ActiveAssetView.CopyLocationsCommand, FallbackValue={x:Static sskk:DisabledCommand.Instance}, Mode=OneWay}"/>
                          <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.Paste" Command="{Binding Session.ActiveAssetView.PasteCommand, FallbackValue={x:Static sskk:DisabledCommand.Instance}, Mode=OneWay}"/>
                          <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.Delete" Command="{Binding Session.DeleteSelectedSolutionItemsCommand, FallbackValue={x:Static sskk:DisabledCommand.Instance}, Mode=OneWay}"/>
                        </i:Interaction.Behaviors>
                        <sskk:TreeView.ItemContainerStyle>
                          <Style TargetType="{x:Type sskk:TreeViewItem}" BasedOn="{StaticResource {x:Type sskk:TreeViewItem}}">
                            <Setter Property="IsExpanded" Value="{Binding Mode=OneTime, Converter={sskk:AssetToExpandedAtInitialization}}"/>
                            <Setter Property="IsEditable" Value="{Binding IsEditable, Mode=OneTime}" d:DataContext="{d:DesignInstance sskk:IIsEditableViewModel}"/>
                            <Setter Property="IsEditing" Value="{Binding IsEditing, Mode=TwoWay}" d:DataContext="{d:DesignInstance sskk:IIsEditableViewModel}"/>
                            <Setter Property="ContextMenu" Value="{StaticResource ContextMenu}"/>
                            <Setter Property="TemplateSelectorEdit" Value="{StaticResource SolutionTreeViewEditTemplate}"/>
                            <Setter Property="sskk:Interaction.Behaviors">
                              <Setter.Value>
                                <sskk:BehaviorCollection>
                                  <sskk:TreeViewStopEditOnLostFocusBehavior/>
                                </sskk:BehaviorCollection>
                              </Setter.Value>
                            </Setter>
                          </Style>
                        </sskk:TreeView.ItemContainerStyle>
                        <sskk:TreeView.ItemTemplate>
                          <HierarchicalDataTemplate ItemsSource="{Binding Content}" ItemTemplateSelector="{StaticResource SolutionTreeViewTemplate}">
                            <TextBlock Text="{Binding Name}"/>
                          </HierarchicalDataTemplate>
                        </sskk:TreeView.ItemTemplate>
                      </sskk:TreeView>
                    </DockPanel>
                  </xcad:LayoutAnchorable>
                </xcad:LayoutAnchorablePane>
                <xcad:LayoutDocumentPane>
                  <!-- ASSET VIEW -->
                  <xcad:LayoutAnchorable ContentId="AssetView" Title="{Binding Source={sskk:Localize Asset view, Context=View}}"
                                           gs:AvalonDockHelper.IsVisible="{Binding Panels.AssetViewPanelVisible, Mode=TwoWay, 
                                           Source={x:Static gs:GameStudioViewModel.GameStudio}, FallbackValue={sskk:True}}">
                    <sskk:AssetViewUserControl AssetCollection="{Binding Session.ActiveAssetView}" AssetContextMenu="{StaticResource AssetContextMenu}"
                                           AssetDoubleClick="{Binding Session.EditSelectedContentCommand}">
                      <i:Interaction.Behaviors>
                        <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.Cut" Command="{Binding Session.ActiveAssetView.CutContentCommand, FallbackValue={x:Static sskk:DisabledCommand.Instance}, Mode=OneWay}"/>
                        <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.Copy" Command="{Binding Session.ActiveAssetView.CopyContentCommand, FallbackValue={x:Static sskk:DisabledCommand.Instance}, Mode=OneWay}"/>
                        <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.Paste" Command="{Binding Session.ActiveAssetView.PasteCommand, FallbackValue={x:Static sskk:DisabledCommand.Instance}, Mode=OneWay}"/>
                        <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.Delete" Command="{Binding Session.ActiveAssetView.DeleteContentCommand}"/>
                        <gs:ActivateParentPaneOnGotFocusBehavior/>
                      </i:Interaction.Behaviors>
                    </sskk:AssetViewUserControl>
                    <i:Interaction.Behaviors>
                      <gs:LayoutAnchorableActivateOnLocationChangedBehavior Collection="{Binding Session.ActiveAssetView.SelectedLocations}" />
                    </i:Interaction.Behaviors>
                  </xcad:LayoutAnchorable>
                </xcad:LayoutDocumentPane>
              </xcad:LayoutPanel>
              <xcad:LayoutAnchorablePane DockHeight="195">
                <!-- REFERENCES -->
                <xcad:LayoutAnchorable ContentId="References" Title="{Binding Source={sskk:Localize References, Context=View}}"
                                       gs:AvalonDockHelper.IsVisible="{Binding Panels.ReferencesPanelVisible, Mode=TwoWay, 
                                       Source={x:Static gs:GameStudioViewModel.GameStudio}, FallbackValue={sskk:True}}">
                  <DockPanel LastChildFill="True" x:Name="RefViewDockPanel">
                    <!-- stats -->
                    <Border DockPanel.Dock="Bottom" Padding="10,5">
                      <TextBlock Text="{Binding Session.References.TypeCountersAsText}" TextTrimming="CharacterEllipsis" TextWrapping="NoWrap">
                        <TextBlock.ToolTip>
                          <TextBlock Text="{Binding Session.References.TypeCountersAsText}" TextTrimming="None" TextWrapping="Wrap" />
                        </TextBlock.ToolTip>
                      </TextBlock>
                    </Border>
                    <!-- view -->
                    <sskk:AssetViewUserControl AssetCollection="{Binding Session.References.DisplayedReferences}" AssetContextMenu="{StaticResource AssetContextMenu}" GiveFocusOnSelectionChange="False"
                                               CanEditAssets="False" CanAddAssets="False" CanDeleteAssets="False" CanRecursivelyDisplayAssets="False" TileThumbnailSize="64" AssetDoubleClick="{Binding Session.ActiveAssetView.SelectAssetCommand}"
                                               BorderThickness="0">
                      <sskk:AssetViewUserControl.PrimaryToolBarItems>
                        <ToggleButton IsChecked="{Binding Session.References.ShowReferencers, Converter={sskk:InvertBool}}" Content="{sskk:Localize References}" MinWidth="80"/>
                        <ToggleButton IsChecked="{Binding Session.References.ShowReferencers}" Content="{sskk:Localize Referenced by}" MinWidth="80"/>
                      </sskk:AssetViewUserControl.PrimaryToolBarItems>
                      <i:Interaction.Behaviors>
                        <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.Cut" Command="{Binding Session.References.DisplayedReferences.CutContentCommand, FallbackValue={x:Static sskk:DisabledCommand.Instance}, Mode=OneWay}"/>
                        <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.Copy" Command="{Binding Session.References.DisplayedReferences.CopyContentCommand, FallbackValue={x:Static sskk:DisabledCommand.Instance}, Mode=OneWay}"/>
                      </i:Interaction.Behaviors>
                    </sskk:AssetViewUserControl>
                  </DockPanel>
                </xcad:LayoutAnchorable>
                <!-- ASSET LOG -->
                <xcad:LayoutAnchorable ContentId="AssetLog"
                                       Title="{sskk:Localize Asset error ({0}), Plural=Asset errors ({0}), Count={Binding Session.AssetLog.ErrorCount, Source={x:Static gs:GameStudioViewModel.GameStudio}}, IsStringFormat=True, Context=View}"
                                       gs:AvalonDockHelper.IsVisible="{Binding Panels.AssetLogPanelVisible, Mode=TwoWay, 
                                       Source={x:Static gs:GameStudioViewModel.GameStudio}, FallbackValue={sskk:True}}">
                  <sskk:GridLogViewer LogMessages="{Binding Session.AssetLog.FilteredMessages}" Session="{Binding Session}" ShowDebugMessages="False" ShowVerboseMessages="False" ShowInfoMessages="False"/>
                </xcad:LayoutAnchorable>
                <!-- BUILD LOG -->
                <xcad:LayoutAnchorable ContentId="BuildLog" Title="{Binding Debugging.OutputTitle, Source={x:Static gs:GameStudioViewModel.GameStudio}}"
                                       gs:AvalonDockHelper.IsVisible="{Binding Panels.BuildLogPanelVisible, Mode=TwoWay, 
                                       Source={x:Static gs:GameStudioViewModel.GameStudio}, FallbackValue={sskk:True}}">
                  <TabControl x:Name="LogTabControl">
                    <TabItem DataContext="{Binding Debugging.BuildLog}">
                      <TabItem.Header>
                        <TextBlock FontWeight="{Binding HasNewMessages, Mode=OneWay, Converter={sskk:BoolToParam},
                                    ConverterParameter={x:Static FontWeights.Bold}, FallbackValue={x:Static FontWeights.Normal}}">
                                    <Run Text="{sskk:Localize Build}"/>
                                    <Run Text="{Binding HasNewMessages, Mode=OneWay, Converter={sskk:BoolToParam}, ConverterParameter=*}"/>
                        </TextBlock>
                      </TabItem.Header>
                      <sskk:TextLogViewer LogMessages="{Binding Messages}" ShowDebugMessages="False" ShowVerboseMessages="False" ShowInfoMessages="True"/>
                      <i:Interaction.Behaviors>
                        <sskk:TabItemActivateOnLogBehavior MinimumLevel="Error" Collection="{Binding Messages}"/>
                      </i:Interaction.Behaviors>
                    </TabItem>
                    <!-- FIXME live scripting is disabled (XK-4309) -->
                    <TabItem DataContext="{Binding Debugging.LiveScriptingLog}" Visibility="Collapsed">
                      <TabItem.Header>
                        <TextBlock FontWeight="{Binding HasNewMessages, Mode=OneWay, Converter={sskk:BoolToParam},
                                    ConverterParameter={x:Static FontWeights.Bold}, FallbackValue={x:Static FontWeights.Normal}}">
                                    <Run Text="{sskk:Localize Live-scripting}"/>
                                    <Run Text="{Binding HasNewMessages, Mode=OneWay, Converter={sskk:BoolToParam}, ConverterParameter=*}"/>
                        </TextBlock>
                      </TabItem.Header>
                      <sskk:TextLogViewer LogMessages="{Binding Messages}" ShowDebugMessages="False" ShowVerboseMessages="False" ShowInfoMessages="True"/>
                      <i:Interaction.Behaviors>
                        <sskk:TabItemActivateOnLogBehavior MinimumLevel="Error" Collection="{Binding Messages}"/>
                      </i:Interaction.Behaviors>
                    </TabItem>
                    <i:Interaction.Behaviors>
                      <sskk:OnEventCommandBehavior Command="{Binding SelectedItem.DataContext.ClearNewMessageFlagCommand, ElementName=LogTabControl}" EventName="SelectionChanged"/>
                    </i:Interaction.Behaviors>
                  </TabControl>
                  <i:Interaction.Behaviors>
                    <sskk:OnEventCommandBehavior Command="{Binding Debugging.ResetOutputTitleCommand}" EventName="IsActiveChanged"/>
                    <gs:LayoutAnchorableActivateOnLogBehavior MinimumLevel="Error" Collection="{Binding Debugging.BuildLog.Messages}"/>
                    <gs:LayoutAnchorableActivateOnLogBehavior MinimumLevel="Error" Collection="{Binding Debugging.LiveScriptingLog.Messages}"/>
                  </i:Interaction.Behaviors>
                </xcad:LayoutAnchorable>
              </xcad:LayoutAnchorablePane>
            </xcad:LayoutPanel>
            <xcad:LayoutPanel Orientation="Vertical" DockWidth="400">
              <xcad:LayoutAnchorablePane DockHeight="2*">
                <!-- PROPERTY GRID -->
                <xcad:LayoutAnchorable ContentId="PropertyGrid" Title="{Binding Source={sskk:Localize Property grid, Context=View}}"
                                       gs:AvalonDockHelper.IsVisible="{Binding Panels.PropertyGridPanelVisible, Mode=TwoWay, 
                                       Source={x:Static gs:GameStudioViewModel.GameStudio}, FallbackValue={sskk:True}}">
                  <Grid Background="{StaticResource ToolBarBackgroundBrush}">
                    <Grid.RowDefinitions>
                      <RowDefinition Height="Auto"/>
                      <RowDefinition Height="Auto"/>
                      <RowDefinition Height="Auto"/>
                      <RowDefinition Height="Auto"/>
                      <RowDefinition Height="*"/>
                      <RowDefinition Height="5"/>
                      <RowDefinition Height="70"/>
                    </Grid.RowDefinitions>
                    <DockPanel Margin="6,6,6,2">
                      <!-- Adding tag -->
                      <sskk:TextBox MinWidth="90" DockPanel.Dock="Right" ValidateOnLostFocus="False" WatermarkContent="{sskk:Localize Add new tag}" x:Name="NewTagTextBox"  Visibility="{Binding Session.ActiveAssetView.SelectedAssets.Count, Converter={sskk:Chained {sskk:NumericToBool}, {sskk:VisibleOrCollapsed}}}">
                        <i:Interaction.Behaviors>
                          <sskk:OnEventCommandBehavior EventName="Validated" Command="{Binding Session.AssetTags.AddTagCommand}" CommandParameter="{Binding Text, ElementName=NewTagTextBox}"/>
                          <sskk:OnEventCommandBehavior EventName="Validated" Command="{x:Static sskk:TextBox.ClearTextCommand}"/>
                        </i:Interaction.Behaviors>
                      </sskk:TextBox>
                      <!-- Navigation -->
                      <StackPanel DockPanel.Dock="Left" Orientation="Horizontal" Margin="0,0,0,6" VerticalAlignment="Center">
                        <Button Content="{sskk:Image {StaticResource ImagePrevious}, 16, 16, HighQuality}" Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"
                            Command="{Binding Session.PreviousSelectionCommand}"
                            ToolTip="{sskk:Localize Previous selection, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Session.Editor.Status}" ToolTipService.ShowOnDisabled="True" />
                        <Button Content="{sskk:Image {StaticResource ImageNext}, 16, 16, HighQuality}" Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"
                            Command="{Binding Session.NextSelectionCommand}"
                            ToolTip="{sskk:Localize Next selection, Context=ToolTip}" sskk:ToolTipHelper.Status="{Binding Session.Editor.Status}" ToolTipService.ShowOnDisabled="True" />
                      </StackPanel>
                      <!-- Description -->
                      <TextBlock TextTrimming="CharacterEllipsis" VerticalAlignment="Center">
                        <Run Text="{Binding Session.ActiveProperties.TypeDescription, Mode=OneWay}" FontWeight="Bold"/>
                        <Run Text="{Binding Session.ActiveProperties.Name, Mode=OneWay}"/>
                      </TextBlock>
                    </DockPanel>
                    <!--  TAGS  -->
                    <ToolBar Grid.Row="1" Margin="6,2" ItemsSource="{Binding Session.AssetTags.Tags}" HorizontalAlignment="Stretch" Visibility="{Binding Session.AssetTags.Tags.Count, Converter={sskk:Chained {sskk:NumericToBool}, {sskk:VisibleOrCollapsed}}}"
                             Style="{StaticResource TagToolBarStyle}">
                      <ToolBar.ItemTemplate>
                        <DataTemplate>
                          <sskk:TagControl Height="20" Margin="2" ToolTip="{Binding Name}" Visibility="{Binding Assets.Count, Converter={sskk:Chained {sskk:NumericToBool}, {sskk:VisibleOrCollapsed}}}"
                                       VerticalAlignment="Center" CloseTagCommand="{Binding RemoveTagCommand}">
                            <StackPanel Orientation="Horizontal">
                              <TextBlock Margin="2,0" Text="{Binding Name}" TextTrimming="CharacterEllipsis" MaxWidth="100" VerticalAlignment="Center" />
                              <TextBlock Text="{Binding Counter}" Cursor="Hand" IsEnabled="{Binding Counter, Converter={sskk:Chained {sskk:StringEquals}, {sskk:InvertBool}, Parameter1={} (all)}}"
                                         ToolTip="{sskk:Localize Add tag to all, Context=ToolTip}">
                            <i:Interaction.Behaviors>
                              <sskk:OnEventCommandBehavior EventName="MouseDown" Command="{Binding AddTagToAllCommand}"/>
                            </i:Interaction.Behaviors>
                              </TextBlock>
                            </StackPanel>
                          </sskk:TagControl>
                        </DataTemplate>
                      </ToolBar.ItemTemplate>
                    </ToolBar>

                    <DockPanel Grid.Row="3" Margin="6,2">
                      <Button Command="{Binding Session.EditSelectedContentCommand}" DockPanel.Dock="Top" HorizontalContentAlignment="Center" Margin="0,0,0,8"
                              Visibility="{Binding Session.EditSelectedContentCommand.IsEnabled, Converter={sskk:VisibleOrCollapsed}, FallbackValue={sskk:Collapsed}}">
                        <Grid>
                          <DockPanel Visibility="{Binding Session.ActiveProperties.CanDisplayProperties, Converter={sskk:VisibleOrCollapsed}}">
                            <Image Source="{StaticResource ImageEditAsset}" Margin="4" DockPanel.Dock="Left" Width="24" Height="24" RenderOptions.BitmapScalingMode="NearestNeighbor"/>
                            <TextBlock Text="{sskk:Localize Open this asset in editor}" Margin="0,4,4,4" VerticalAlignment="Center" />
                          </DockPanel>
                          <TextBlock Text="{sskk:Localize Show this asset in editor}" Margin="0,4,4,4" VerticalAlignment="Center"
                                     Visibility="{Binding Session.ActiveProperties.CanDisplayProperties, Converter={sskk:Chained {sskk:InvertBool}, {sskk:VisibleOrCollapsed}}}" />
                        </Grid>
                      </Button>
                      <DockPanel Visibility="{Binding Session.ActiveProperties.CanDisplayProperties, Converter={sskk:VisibleOrCollapsed}}">
                        <!-- TODO: Disabling this button for now, it is relatively terrible in term of UX -->
                        <ToggleButton Margin="4,0" Height="22" Width="22" Content="{sskk:Image {StaticResource ImageAssetOverride}, 16, 16}"
                                      IsChecked="{Binding Session.ActiveProperties.ShowOverridesOnly}" ToolTip="{sskk:Localize Display only overridden properties, Context=ToolTip}"
                                      Visibility="Collapsed"/>
                        <AdornerDecorator>
                          <sskk:TextBox UseTimedValidation="True" x:Name="PropertyFilterTextBox" WatermarkContent="{sskk:Localize Search properties}">
                            <i:Interaction.Behaviors>
                              <sskk:ContainTextAdornerBehavior />
                            </i:Interaction.Behaviors>
                          </sskk:TextBox>
                        </AdornerDecorator>
                      </DockPanel>
                    </DockPanel>

                    <TextBlock Grid.Row="4" Text="{Binding Session.ActiveProperties.FallbackMessage}" HorizontalAlignment="Center" VerticalAlignment="Center"
                           Visibility="{Binding Session.ActiveProperties.CanDisplayProperties, Converter={sskk:Chained {sskk:InvertBool}, {sskk:VisibleOrCollapsed}}}"/>
                    <sskk:PropertyView x:Name="AssetPropertyView" Grid.Row="4"
                                       ItemsSource="{Binding Session.ActiveProperties.ViewModel.RootNode.Children}"
                                       Visibility="{Binding Session.ActiveProperties.CanDisplayProperties, Converter={sskk:VisibleOrCollapsed}}">
                      <sskk:PropertyView.Resources>
                        <SolidColorBrush x:Key="ItemHoverBrush" Color="#FF525252" />
                        <RoutedUICommand x:Key="ReplaceCommand" Text="Replace">
                          <RoutedUICommand.InputGestures>
                            <KeyGesture>Ctrl+Shift+V</KeyGesture>
                          </RoutedUICommand.InputGestures>
                        </RoutedUICommand>
                      </sskk:PropertyView.Resources>
                      <sskk:PropertyView.ItemContainerStyle>
                        <Style BasedOn="{StaticResource {x:Type sskk:PropertyViewItem}}" TargetType="sskk:PropertyViewItem">
                          <Setter Property="Background" Value="Transparent"/>
                          <Setter Property="ContextMenu">
                            <Setter.Value>
                              <ContextMenu Visibility="{Binding HasItems, RelativeSource={RelativeSource Self}, Converter={sskk:VisibleOrHidden}, FallbackValue={sskk:Hidden}}">
                                <MenuItem Header="{sskk:Localize Reset to base value, Context=Menu}" Command="{Binding ResetOverride, FallbackValue={x:Static sskk:DisabledCommand.Instance}, Mode=OneWay}"
                                          IsEnabled="{Binding HasBase}"/>
                                <Separator />
                                <MenuItem Icon="{sskk:Image {StaticResource ImageCopy}}"
                                          Command="ApplicationCommands.Copy" CommandTarget="{Binding PlacementTarget, RelativeSource={RelativeSource AncestorType={x:Type MenuBase}}}"/>
                                <MenuItem Icon="{sskk:Image {StaticResource ImagePaste}}"
                                          Command="ApplicationCommands.Paste" CommandTarget="{Binding PlacementTarget, RelativeSource={RelativeSource AncestorType={x:Type MenuBase}}}" />
                                <MenuItem Icon="{sskk:Image {StaticResource ImagePaste}}"
                                          Visibility="{Binding HasCommand_ReplaceProperty, Converter={sskk:VisibleOrCollapsed}, FallbackValue={sskk:Collapsed}}"
                                          Command="{StaticResource ReplaceCommand}" CommandTarget="{Binding PlacementTarget, RelativeSource={RelativeSource AncestorType={x:Type MenuBase}}}"/>
                              </ContextMenu>
                            </Setter.Value>
                          </Setter>
                          <Setter Property="HeaderTemplate">
                            <Setter.Value>
                              <HierarchicalDataTemplate ItemsSource="{Binding Children, Mode=OneWay}" DataType="viewModels:NodeViewModel">
                                <ContentPresenter Content="{Binding}" ContentTemplateSelector="{x:Static sskk:PropertyViewHelper.HeaderProviders}"/>
                              </HierarchicalDataTemplate>
                            </Setter.Value>
                          </Setter>
                          <Setter Property="Template">
                            <Setter.Value>
                              <ControlTemplate TargetType="sskk:PropertyViewItem">
                                <Border BorderThickness="{TemplateBinding Border.BorderThickness}" BorderBrush="{TemplateBinding Border.BorderBrush}" SnapsToDevicePixels="True"
                                        Visibility="{Binding IsVisible, Converter={sskk:VisibleOrCollapsed}}" d:DataContext="{d:DesignInstance viewModels:NodeViewModel}">
                                  <DockPanel>
                                    <Border DockPanel.Dock="Top" Background="{TemplateBinding Background}">
                                      <ContentPresenter ContentSource="Header" Name="PART_Header"
                                                        Content="{TemplateBinding HeaderedContentControl.Header}"
                                                        ContentTemplate="{TemplateBinding HeaderTemplate}"
                                                        ContentTemplateSelector="{TemplateBinding HeaderTemplateSelector}"
                                                        ContentStringFormat="{TemplateBinding HeaderedItemsControl.HeaderStringFormat}"                                                       
                                                        HorizontalAlignment="{TemplateBinding Control.HorizontalContentAlignment}"
                                                        SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}"
                                                        Visibility="{sskk:MultiBinding {Binding DataContext.Session.ActiveProperties.ShowOverridesOnly, Converter={sskk:InvertBool}, RelativeSource={RelativeSource AncestorType=sskk:PropertyView}},
                                                                                       {Binding IsOverridden},
                                                                                       {Binding HasBase, Converter={sskk:InvertBool}},
                                                                                       Converter={sskk:MultiChained {sskk:OrMultiConverter}, {sskk:VisibleOrCollapsed}}}"/>
                                    </Border>
                                    <Expander x:Name="propertyExpander" IsExpanded="{TemplateBinding IsExpanded}" Style="{StaticResource PropertyExpanderStyle}" IsEnabled="True">
                                      <StackPanel>
                                        <ItemsPresenter Name="ItemsHost"/>
                                        <Border Background="{TemplateBinding Background}">
                                          <ContentPresenter Name="PART_Footer"
                                                            Content="{TemplateBinding HeaderedContentControl.Header}"
                                                            ContentTemplateSelector="{x:Static sskk:PropertyViewHelper.FooterProviders}"
                                                            HorizontalAlignment="{TemplateBinding Control.HorizontalContentAlignment}"
                                                            SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}"
                                                            Visibility="{sskk:MultiBinding {Binding DataContext.Session.ActiveProperties.ShowOverridesOnly, Converter={sskk:InvertBool}, RelativeSource={RelativeSource AncestorType=sskk:PropertyView}},
                                                                                           {Binding IsOverridden},
                                                                                           {Binding HasBase, Converter={sskk:InvertBool}},
                                                                                           Converter={sskk:MultiChained {sskk:OrMultiConverter}, {sskk:VisibleOrCollapsed}}}"/>
                                        </Border>
                                      </StackPanel>
                                    </Expander>
                                  </DockPanel>
                                </Border>
                              </ControlTemplate>
                            </Setter.Value>
                          </Setter>
                          <Setter Property="sskk:Interaction.Behaviors">
                            <Setter.Value>
                              <sskk:BehaviorCollection>
                                <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.Copy" ContinueRouting="False" Command="{Binding CopyProperty, FallbackValue={x:Static sskk:DisabledCommand.Instance}, Mode=OneWay}"/>
                                <sskk:CommandBindingBehavior RoutedCommand="ApplicationCommands.Paste" ContinueRouting="False" Command="{Binding PasteProperty, FallbackValue={x:Static sskk:DisabledCommand.Instance}, Mode=OneWay}"/>
                                <sskk:CommandBindingBehavior RoutedCommand="{StaticResource ReplaceCommand}" ContinueRouting="False" Command="{Binding ReplaceProperty, FallbackValue={x:Static sskk:DisabledCommand.Instance}, Mode=OneWay}" />
                                <sskk:PropertyViewFilteringBehavior FilterToken="{Binding Text, ElementName=PropertyFilterTextBox, Mode=OneWay}"/>
                                <sskk:PropertyViewItemDragDropBehavior CanDrop="False" CanDrag="False" CanInsert="True"/>
                              </sskk:BehaviorCollection>
                            </Setter.Value>
                          </Setter>
                          <Style.Triggers>
                            <DataTrigger Binding="{Binding Documentation, FallbackValue={x:Null}}" Value="{x:Null}">
                              <Setter Property="Highlightable" Value="False"/>
                            </DataTrigger>
                            <Trigger Property="IsHovered" Value="True">
                              <Setter Property="Background" Value="{StaticResource ItemHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                              <Setter Property="Background" Value="{StaticResource NormalBrush}"/>
                            </Trigger>
                            <Trigger Property="IsKeyboardActive" Value="True">
                              <Setter Property="Background" Value="{StaticResource NormalBrush}"/>
                            </Trigger>
                          </Style.Triggers>
                          <Style.Resources>
                            <Style TargetType="{x:Type sskk:TextBox}" BasedOn="{StaticResource {x:Type sskk:TextBox}}">
                              <Setter Property="ToolTip" Value="{Binding Text, RelativeSource={RelativeSource Self}}" />
                              <Setter Property="ToolTipService.IsEnabled" Value="{Binding Text, RelativeSource={RelativeSource Self}, Converter={sskk:Chained {sskk:EmptyStringToBool}, {sskk:InvertBool}, Parameter1={sskk:True}}}" />
                            </Style>
                          </Style.Resources>
                        </Style>
                      </sskk:PropertyView.ItemContainerStyle>
                      <i:Interaction.Behaviors>
                        <sskk:PropertyViewDragDropBehavior Target="{Binding Session.ActiveProperties.ViewModel}" CanDrag="False" CanDrop="True" CanInsert="False" />
                        <sskk:PropertyViewFilteringBehavior FilterToken="{Binding Text, ElementName=PropertyFilterTextBox, Mode=OneWay}"/>
                        <sskk:PropertyViewAutoExpandNodesBehavior ViewModel="{Binding Session.ActiveProperties.ViewModel, Mode=OneWay}"/>
                      </i:Interaction.Behaviors>
                    </sskk:PropertyView>

                    <GridSplitter Grid.Row="5" HorizontalAlignment="Stretch" Height="5" ResizeBehavior="PreviousAndNext"/>

                    <Border Grid.Row="6" Background="{StaticResource ToolBarBackgroundBrush}">
                      <DockPanel>
                        <TextBlock Margin="4" DockPanel.Dock="Top" FontWeight="Bold" Text="{Binding HoveredItem.DataContext.DisplayName, ElementName=AssetPropertyView}" TextTrimming="CharacterEllipsis"/>
                        <TextBlock Margin="4" Text="{Binding HoveredItem.DataContext.Documentation, ElementName=AssetPropertyView}" TextWrapping="Wrap" TextTrimming="WordEllipsis"/>
                      </DockPanel>
                    </Border>
                  </Grid>
                </xcad:LayoutAnchorable>
              </xcad:LayoutAnchorablePane>
              <xcad:LayoutAnchorablePaneGroup DockHeight="1*">
                <xcad:LayoutAnchorablePane>
                  <!-- ASSET PREVIEW -->
                  <xcad:LayoutAnchorable ContentId="AssetPreview" Title="{Binding Source={sskk:Localize Asset preview, Context=View}}"
                                         gs:AvalonDockHelper.IsVisible="{Binding Panels.AssetPreviewPanelVisible, Mode=TwoWay, 
                                         Source={x:Static gs:GameStudioViewModel.GameStudio}, FallbackValue={sskk:True}}">
                    <DockPanel LastChildFill="True">
                      <ContentPresenter Content="{Binding Preview.PreviewObject}"/>
                    </DockPanel>
                  </xcad:LayoutAnchorable>
                  <!-- ACTION HISTORY -->
                  <xcad:LayoutAnchorable ContentId="ActionHistory" Title="{Binding Source={sskk:Localize Edit history, Context=View}}"
                                         gs:AvalonDockHelper.IsVisible="{Binding Panels.ActionHistoryPanelVisible, Mode=TwoWay, 
                                         Source={x:Static gs:GameStudioViewModel.GameStudio}, FallbackValue={sskk:True}}">
                    <ListBox ItemsSource="{Binding Session.ActionHistory.Transactions}" HorizontalContentAlignment="Stretch">
                      <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem" BasedOn="{StaticResource {x:Type ListBoxItem}}">
                          <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        </Style>
                      </ListBox.ItemContainerStyle>
                      <ListBox.ItemTemplate>
                        <DataTemplate>
                          <DockPanel HorizontalAlignment="Stretch">
                            <TextBlock DockPanel.Dock="Left" x:Name="txt" Text="{Binding Name, Mode=OneWay}"/>
                            <Image DockPanel.Dock="Right" x:Name="img" Source="{StaticResource ImageSave}" HorizontalAlignment="Right" Visibility="Hidden"/>
                          </DockPanel>
                          <DataTemplate.Triggers>
                            <DataTrigger Binding="{Binding IsDone, Mode=OneWay}" Value="False">
                              <Setter TargetName="txt" Property="Foreground" Value="{DynamicResource PressedBrush}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsSavePoint, Mode=OneWay}" Value="True">
                              <Setter TargetName="img" Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                          </DataTemplate.Triggers>
                        </DataTemplate>
                      </ListBox.ItemTemplate>
                    </ListBox>
                  </xcad:LayoutAnchorable>
                </xcad:LayoutAnchorablePane>
              </xcad:LayoutAnchorablePaneGroup>
            </xcad:LayoutPanel>
          </xcad:LayoutPanel>
        </xcad:LayoutRoot>
      </xcad:DockingManager>
      <StatusBar Grid.Row="2" Visibility="{Binding Session, Converter={sskk:Chained {sskk:ObjectToBool}, {sskk:VisibleOrCollapsed}}}">
        <StatusBar.ItemsPanel>
          <ItemsPanelTemplate>
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="100"/>
              </Grid.ColumnDefinitions>
            </Grid>
          </ItemsPanelTemplate>
        </StatusBar.ItemsPanel>
        <StatusBarItem Grid.Column="0" Content="{Binding Status.CurrentStatus}"/>
        <Separator Grid.Column="1"/>
        <StatusBarItem Grid.Column="2">
          <TextBlock>
            <Run Text="{sskk:Localize {}{0} item, Plural={}{0} items, Count={Binding Session.ActiveAssetView.FilteredContent.Count, Mode=OneWay}, IsStringFormat=True, Context=StatusBar}"/>
            <Run Text="{sskk:Localize ({0} selected), Plural=({0} selected), Count={Binding Session.ActiveAssetView.SelectedContent.Count, Mode=OneWay}, IsStringFormat=True, Context=StatusBar}"/>
          </TextBlock>
        </StatusBarItem>
        <Separator Grid.Column="3"/>
        <StatusBarItem Grid.Column="4" HorizontalContentAlignment="Right">
          <TextBlock Margin="5,0" Text="{Binding Status.CurrentJob.Message}"/>
        </StatusBarItem>
        <StatusBarItem Grid.Column="5" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch">
          <ProgressBar Visibility="{Binding Status.CurrentJob, Converter={sskk:Chained {sskk:ObjectToBool}, {sskk:VisibleOrCollapsed}}}"
                       IsIndeterminate="{Binding Status.CurrentJob.IsIndeterminate}" Maximum="{Binding Status.CurrentJob.Total}"
                       Value="{Binding Status.CurrentJob.Current}">
          </ProgressBar>
        </StatusBarItem>
      </StatusBar>
    </Grid>
  </Grid>
</Window>

